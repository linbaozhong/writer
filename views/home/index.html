<!DOCTYPE html>

<html>

	<head>
		<title>非线性协作</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<link rel="stylesheet" type="text/css" href="../static/css/jquery-ui.css" />
		<link rel="stylesheet" type="text/css" href="../static/css/iconFont.min.css" />
		<link rel="stylesheet" type="text/css" href="../static/css/metro-bootstrap.min.css" />
		<script src="../static/js/jquery-2.1.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../static/js/jquery-ui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../static/js/jquery.mousewheel.js" type="text/javascript"></script>
		<!--编辑器-->
		<script type="text/javascript" charset="utf-8" src="../static/js/ueditor.config.js"></script>
		<script type="text/javascript" charset="utf-8" src="../static/js/ueditor.all.min.js"></script>
		<script type="text/javascript" src="../static/js/lang/zh-cn/zh-cn.js"></script>
		<script type="text/javascript" charset="utf-8" src="../static/js/kityformula-plugin/addKityFormulaDialog.js"></script>
		<script type="text/javascript" charset="utf-8" src="../static/js/kityformula-plugin/getKfContent.js"></script>
		<script type="text/javascript" charset="utf-8" src="../static/js/kityformula-plugin/defaultFilterFix.js"></script>
		<!--滚动条-->
		<link rel="stylesheet" type="text/css" href="../static/css/jquery.mCustomScrollbar.min.css" />
		<script src="../static/js/jquery.accordion.0.1.js" type="text/javascript" charset="utf-8"></script>
		<script src="../static/js/metro-loader.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="../static/css/index.css" />
	</head>

	<body class="metro">
		<!--左侧导航条-->
		<nav id="nav-left" class="bg-dark fg-white shadow padding10">
			<div class="tile half bg-dark">
				教育
			</div>
			<div class="tile half bg-dark">
				分类
			</div>
		</nav>

		<!--右侧导航条-->
		<nav id="nav-right" class="bg-dark fg-white shadow">
			<div style="padding:10px;">
				<div class="tile half bg-cyan" data-hint="登录/注册" data-hint-position="left" data-click="transform" data-role="1" data-rel="signin">
					<div class="tile-content icon">
						<i class="icon-key-2"></i>
					</div>
				</div>
				<!--书签-->
				<div class="tile half bg-cyan" data-hint="书签" data-hint-position="left" data-click="transform" data-role="0" data-rel="bookmarks">
					<div class="tile-content icon">
						<i class="icon-air"></i>
					</div>
				</div>

			</div>
		</nav>
		<!--导航条弹出框-->
		<div class="nav-info-box bg-gray opacity">

		</div>
		<div class="nav-info">

		</div>
		<!--中间的注册登录框-->
		<div id="snow-sign" class="bg-gray shadow">
			<div class="user-sign">
				<a href="javascript:;" class="getout icon-cancel-2 place-top-right margin5 fg-white border padding5" style="border-radius: 50%;">
				</a>
				<div class="padding20">
					<h2 class="padding10 fg-white">使用合作网站账户登录</h2>
					<div class="form-actions">
						<div class="horizontal-list">
							<ul>
								<li class="padding5 margin5 fg-white" id="qqLogin">QQ</li>
								<li class="padding5 margin5 fg-white">新浪微博(暂不可用)</li>
							</ul>
						</div>
					</div>
				</div>
				<hr />
				<div class="" data-load="signin">

				</div>
				<hr />
				<div class="" data-load="signup">

				</div>
				<hr />
				<div class="padding20 margin10">
					<button type="button" class="getout button primary large" style="width: 100%;font-weight: bold;">爷就这么任性</button>
				</div>
			</div>
		</div>
		<!--左侧框--工作区-->
		<div id="snow-left" class="bg-white">
			<div class="chouti" style="height:100%;">
				<div class="frame">
					<header>
						<form class="doc user-input native" style="display:none;">
							<input type="hidden" name="id" id="doc-id" value="" />
							<script id="myEditor" name="content" type="text/plain">

							</script>
							<!--<div class="input-control textarea">
								<textarea id="myEditor" name="content" rows="" cols="" placeholder="写点儿什么……"></textarea>
							</div>-->
							<!--<div class="form-actions input-control text">
								<input type="text" name="tags" id="tags" value="" placeholder="标签" />
							</div>-->
							<div class="form-actions text-right" style="margin-top: 10px;">
								<button name="btn-save" type="button" data-role="0" class="button primary">保存</button>
								<button name="btn-cancel" type="button" data-role="0" class="button">取消</button>
							</div>
						</form>
						<div class="doc-add text-center padding20">
							<a href="javascript:;" class="doc-plus">新<i class="icon-plus on-right on-left"></i>建</a>
						</div>
					</header>

					<div class="doc" data-id="1">
						<div class="doc-tools">
							<a href="javascript:;" class="tools edit icon-pencil">
							</a>
							<a href="javascript:;" class="tools del icon-cancel-2">
							</a>
						</div>
						<article class="doc-info">
							<div class="doc-content">
								<h1>



							标题标题标题标题标题标题



						</h1>
								<p>正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文</p>
							</div>
						</article>
						<footer class="text-center">
							<div class="pos-abs">
								<span class="doc-remark"></span>
							</div>
							<div class="doc-tools">
								<span class="tools icon-new-tab"><i>456</i></span>
								<span class="tools icon-heart-2"><i>123</i></span>
							</div>
							<a href="javascript:;" class="doc-plus">在下面<i class="icon-plus on-right on-left"></i>新建</a>
						</footer>
					</div>
					<div class="doc">
						<div class="doc-tools">
							<a href="javascript:;" class="tools edit icon-pencil">
							</a>
							<a href="javascript:;" class="tools del icon-cancel-2">
							</a>
						</div>
						<article class="doc-info">
							<div class="doc-content">
								<h2>



							标题标题标题标题标题标题



						</h2>
								<p>正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文</p>
							</div>
						</article>
						<footer class="text-center">
							<div class="pos-abs">
								<span class="doc-remark"></span>
							</div>
							<div class="doc-tools">
								<span class="tools icon-new-tab"><i>456</i></span>
								<span class="tools icon-heart-2"><i>123</i></span>
							</div>
							<a href="javascript:;" class="doc-plus">在下面<i class="icon-plus on-right on-left"></i>新建</a>
						</footer>
					</div>
					<div class="doc">
						<div class="doc-tools">
							<a href="javascript:;" class="tools edit icon-pencil">
							</a>
							<a href="javascript:;" class="tools del icon-cancel-2">
							</a>
						</div>
						<article class="doc-info">
							<div class="doc-content">
								<h3>



							标题标题标题标题标题标题



						</h3>
								<p>正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文</p>
							</div>
						</article>
						<footer class="text-center">
							<div class="pos-abs">
								<span class="doc-remark"></span>
							</div>
							<div class="doc-tools">
								<span class="tools icon-new-tab"><i>456</i></span>
								<span class="tools icon-heart-2"><i>123</i></span>
							</div>
							<a href="javascript:;" class="doc-plus">在下面<i class="icon-plus on-right on-left"></i>新建</a>
						</footer>
					</div>
					<div class="doc">
						<div class="doc-tools">
							<a href="javascript:;" class="tools edit icon-pencil">
							</a>
							<a href="javascript:;" class="tools del icon-cancel-2">
							</a>
						</div>
						<article class="doc-info">
							<div class="doc-content">
								<h3>



							1111111111111111111111111111111



						</h3>
								<p>正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文</p>
							</div>
						</article>
						<footer class="text-center">
							<div class="pos-abs">
								<span class="doc-remark"></span>
							</div>
							<div class="doc-tools">
								<span class="tools icon-new-tab"><i>456</i></span>
								<span class="tools icon-heart-2"><i>123</i></span>
							</div>
							<a href="javascript:;" class="doc-plus">在下面<i class="icon-plus on-right on-left"></i>新建</a>
						</footer>
					</div>
					<div class="doc">
						<div class="doc-tools">
							<a href="javascript:;" class="tools edit icon-pencil">
							</a>
							<a href="javascript:;" class="tools del icon-cancel-2">
							</a>
						</div>
						<article class="doc-info">
							<div class="doc-content">
								<h3>



							2222222222222222222222222



						</h3>
								<p>正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文</p>
							</div>
						</article>
						<footer class="text-center">
							<div class="pos-abs">
								<span class="doc-remark"></span>
							</div>
							<div class="doc-tools">
								<span class="tools icon-new-tab"><i>456</i></span>
								<span class="tools icon-heart-2"><i>123</i></span>
							</div>
							<a href="javascript:;" class="doc-plus">在下面<i class="icon-plus on-right on-left"></i>新建</a>
						</footer>
					</div>
					<div class="doc">
						<div class="doc-tools">
							<a href="javascript:;" class="tools edit icon-pencil">
							</a>
							<a href="javascript:;" class="tools del icon-cancel-2">
							</a>
						</div>
						<article class="doc-info">
							<div class="doc-content">
								<h3>



							3333



						</h3>
								<p>正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文</p>
							</div>
						</article>
						<footer class="text-center">
							<div class="pos-abs">
								<span class="doc-remark"></span>
							</div>
							<div class="doc-tools">
								<span class="tools icon-new-tab"><i>456</i></span>
								<span class="tools icon-heart-2"><i>123</i></span>
							</div>
							<a href="javascript:;" class="doc-plus">在下面<i class="icon-plus on-right on-left"></i>新建</a>
						</footer>
					</div>
					<div class="doc">
						<div class="doc-tools">
							<a href="javascript:;" class="tools edit icon-pencil">
							</a>
							<a href="javascript:;" class="tools del icon-cancel-2">
							</a>
						</div>
						<article class="doc-info">
							<div class="doc-content">
								<h3>



							44444444444



						</h3>
								<p>正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文正文</p>
							</div>
						</article>
						<footer class="text-center">
							<div class="pos-abs">
								<span class="doc-remark"></span>
							</div>
							<div class="doc-tools">
								<span class="tools icon-new-tab"><i>456</i></span>
								<span class="tools icon-heart-2"><i>123</i></span>
							</div>
							<a href="javascript:;" class="doc-plus">在下面<i class="icon-plus on-right on-left"></i>新建</a>
						</footer>
					</div>
					<footer>
						<div class="mask" />
					</footer>
				</div>
			</div>
		</div>
		<!--滚动条-->
		<div id="scrollbar_vertical" class="mCSB_scrollTools mCSB_1_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical" style="display: block;">
			<div class="mCSB_draggerContainer">
				<div id="dragger_vertical" class="mCSB_dragger" style="position: absolute; min-height: 50px; height: 416px; top: 49px; display: block; max-height: 455px;" oncontextmenu="return false;">
					<div class="mCSB_dragger_bar" style="line-height: 50px;"></div>
				</div>
				<div class="mCSB_draggerRail"></div>
			</div>
		</div>
		<!--书签-->
		<!--<div class="bookmarks bookmarks-left bg-gray">
			<h1>
			<i class="icon-arrow-left-3 fg-white"></i></h1>
		</div>
		<div class="bookmarks bookmarks-right bg-gray">
			<h1>
			<i class="icon-arrow-right-3 fg-white"></i></h1>
		</div>-->
	</body>

</html>
<script type="text/javascript">
	var snow = {
		speed: 300,
		width: $(window).width(),
		log: function() {
			console.log(arguments);
		},
		inc: function() {
			return '../static/inc/_' + arguments[0] + '.html';
		},
		left: $('#snow-left'),
		scrollbar: $('#scrollbar_vertical'),
		//实例化编辑器
		ue: UE.getEditor('myEditor')
	};
	// 滚动条拖拽块事件
	snow.scrollbar.drager = snow.scrollbar.find('#dragger_vertical').draggable({
		axis: "y",
		containment: "parent",
		drag: function(e, ui) {
			var _this = $(this).css('left', 0).closest('.frame'),
				_height = _this.outerHeight(),
				_first = _this.find('>header'),
				_last = _this.find('>footer'),
				_maxHeight = Math.abs(parseInt(_first.css('marginTop'))) + _last.offset().top + _last.outerHeight(),
				_step = _height / _maxHeight,
				_top = ui.position.top / _step * (-1);

			_first.css({
				marginTop: _top
			});

			// 保存当前位置
			_this.data('position', _top);
		}
	});
	//隐藏位置
	snow.hidden = {
		left: -1000,
		right: -1000
	};
	//

	// 导航条
	snow.nav = {
		left: $('#nav-left'),
		right: $('#nav-right')
	};
	snow.nav.left.width = snow.nav.left.width();
	snow.nav.right.width = snow.nav.right.width();
	//注册登录框
	snow.sign = $('#snow-sign').css({
		width: 400,
		right: snow.nav.right.width,
		left: snow.nav.left.width
	});

	// 文档编辑框
	snow.editor = snow.left.find('form.native').eq(0).click(function(e) {
		if (snow.left.find('form.editing').length) {
			return;
		}
		var _form = $(this);
		if (_form.hasClass('editing') && _form.find('textarea').val() == '') {} else if (!_form.hasClass('editing')) {
			_form.addClass('editing').slideDown(function() {
				snow.docResize(_form.closest('.frame'));
			});
		}
	}).on('click', 'button', function(e) { //表单保存(取消)事件
		e.stopPropagation();
		var _that = $(this),
			_form = _that.closest('form.user-input'),
			_frame = _form.closest('.frame');

		if (_that.attr('name') == 'btn-save') { //保存
			var __doc = _form.prev('div.doc');
			console.log(_form.find('input[name="id"]').val());
			// 新建文档
			if (_form.find('input[name="id"]').val() == '') {
				// 在_form之前插入一个新doc
			} else {
				// 编辑修改，修改form之前的doc
				__doc.find('.doc-content').html(snow.ue.getContent());
			}
		} else { //取消

		}
		// 复原
		_form.removeClass('editing').slideUp(snow.speed, function() {
			// 顶端新增按钮
			if (_form.prev('div.doc-add').length) {
				_form.prev('div.doc-add').fadeIn(function() {
					snow.docResize(_frame);
				});
			} else if (_form.prev('div.doc').length) {
				_form.prev('div.doc').fadeIn(function() {
					snow.docResize(_frame);
				});
			} else {
				snow.docResize(_frame);
			}
		}).find('textarea').val('');
	});

	/*
	 * 解决传统浏览器不支持placeholder问题
	 */
	function placeholder() {

		if (!('placeholder' in document.createElement('input'))) {

			$('input[placeholder],textarea[placeholder]').each(function() {

				var that = $(this),
					text = that.attr('placeholder');

				if (that.val() === "") {
					that.val(text).addClass('placeholder');
				}
				that.focus(function() {
					if (that.val() === text) {
						that.val("").removeClass('placeholder');
					}
				}).blur(function() {
					if (that.val() === "") {
						that.val(text).addClass('placeholder');
					}
				}).closest('form').submit(function() {
					if (that.val() === text) {
						that.val('');
					}
				});
			});
		}
	};
	/*
	 * 页面数据拉取
	 */
	function dataLoading() {
		$('[data-load]').each(function() {
			var _this = $(this),
				_data = _this.data('load');
			if (_data && _data.length > 0) {
				_this.load(snow.inc(_this.data('load')));
			}
		});
	};

	//打开登录注册框
	function openSign() {
		if (!snow.sign.hasClass('active')) {
			snow.sign.animate({
				top: 0
			}, snow.speed, function() {
				snow.sign.addClass('active');
			});
		}
	}

	/* 增加单个文档
	 * frame:容器
	 * doc:文档
	 * before:文档位置，true表示最前，false表示最后
	 */
	snow.addDoc = function(frame, doc, before) {
		if (before) {
			frame.find('>header').after(doc);
		} else {
			frame.find('>footer').before(doc);
		}
	}


	$(function() {
		setTimeout(function() {
			// 拉取数据
			dataLoading();
			// 解决传统浏览器不支持placeholder问题
			placeholder();
			//打开登录注册框
			openSign();
			// accordion插件
			snow.chouti = snow.left.find('div.chouti').accordion({
				horizontal: true
			});

			// 选中第一个文档
			snow.left.find('.frame div.doc').eq(0).click();

		}, 100);
		// 书签事件
		$('div.bookmarks').hover(
			function() {
				$(this).css('opacity', 0.8);
			},
			function() {
				$(this).css('opacity', 0.1);
			}
		);
		// 左导航条---事件
		snow.nav.left.on('click', '.tile', function(e) {
			var _that = $(this).addClass('active').siblings('.active').removeClass('active');
		});
		// 右导航条---事件
		snow.nav.right.on('click', '.tile', function(e) {
			var _that = $(this);
			if (_that.data('rel') == 'signin') {
				openSign();
			} else {
				//
				$('div.nav-info').load(snow.inc(_that.data('rel')), function() {
					$('div.nav-info-box').css({
						width: $('div.nav-info').eq(0).width()
					});
				});
				$('div.nav-info-box,div.nav-info').animate({
					right: snow.nav.right.width
				});
			}
		});

		//关闭登陆框
		$(".getout").click(function() {
			snow.sign
				.removeClass('active')
				.animate({
					top: '-2000px'
				}, snow.speed, function() {
					if (snow.nav.right.is(':hidden')) {
						snow.nav.right.animate({
							right: 0
						}, snow.speed).show();
					}
				});
		});
		// resize事件
		snow.docResize = function(_this) {
			//滚动条
			_this.append(snow.scrollbar);

			var _height = _this.outerHeight(),
				_first = _this.find('>header'),
				_last = _this.find('>footer'),
				_maxHeight = Math.abs(parseInt(_first.css('marginTop'))) + _last.offset().top + _last.outerHeight(),
				_step = _height / _maxHeight,
				_top = _this.data('position') || 0;

			if (_first === _last || _maxHeight <= _height) {
				snow.scrollbar.hide();
				_first.css({
					marginTop: 0
				});
				snow.scrollbar.drager.css({
					top: 0
				});
			} else {
				var _toTop = _height - _last.offset().top - _last.outerHeight()

				if (_toTop > 0) {
					_first.css('marginTop', '+=' + _toTop);
				} else {
					_first.css({
						marginTop: _top
					});
				}
				snow.scrollbar.show();
				snow.scrollbar.drager.css({
					maxHeight: _height,
					height: _height * _step,
					top: parseInt(_first.css('marginTop')) * _step * (-1)
				});
			}
			// 记录位置
			_this.data('position', _first.css('marginTop'));
		};
		//
		snow.left.on('mousewheel', '.frame', function(e, delta) {
			// 只有滚动条才可滚动
			if (snow.scrollbar.is(':hidden')) {
				return;
			}
			var _this = $(this),
				_height = _this.outerHeight(),
				_first = _this.find('>header'),
				_last = _this.find('>footer'),
				_maxHeight = Math.abs(parseInt(_first.css('marginTop'))) + _last.offset().top + _last.outerHeight(),
				_step = _height / _maxHeight,
				_top = parseInt(_first.css('marginTop')) + (delta * 20);

			// 向上
			if (delta > 0 && _top > 0) {
				return;
			} else if (delta < 0 && parseInt(snow.scrollbar.drager.css('top')) + snow.scrollbar.drager.height() >= _height) {
				return;
			}

			_first.css({
				marginTop: _top
			});

			snow.scrollbar.drager.css({
				top: _top * _step * (-1)
			});
			// 保存当前位置
			_this.data('position', _top);

		}).on('mouseenter', '.frame', function(e) {
			// 刷新滚动条
			snow.docResize($(this));
		}).on('click', '.frame div.doc', function(e) {
			e.stopPropagation();
			var _doc = $(this);

			// 追加一个frame
			if (!_doc.closest('.frame').next().length) {
				snow.chouti.add({
					title: '',
					url: 'it.htm',
					active: false
				}, function(frame) {
					frame.prepend('<footer><div class="mask" /></footer>');
					//frame.prepend($('<header />').append(snow.editor.clone(true)));
					frame.prepend(
						$('<header />').append('<div class="doc-add text-center padding20">' + '<a href="javascript:;" class="doc-plus">新<i class="icon-plus on-right on-left"></i>建</a>' + '</div>')
					);
					frame.find('.mask').css({
						width: frame.outerWidth(),
						height: frame.outerHeight()
					});
				});
			}
			// 复原编辑表单
			if (!_doc.hasClass('active')) {
				_doc.siblings('.active').removeClass('active');

				// 激活doc
				_doc.addClass('active');

			}

		}).on('click', '.frame .tools.del', function(e) {
			e.stopPropagation();
			var _doc = $(this).closest('div.doc');

			if (_doc.next().hasClass('clone')) {
				_doc.next().hide();
			}

			_doc.remove();
			//
			snow.docResize(_doc.closest('.frame'));
		}).on('click', '.frame .doc .tools.edit', function(e) {
			e.stopPropagation();
			// 如果有仍未提交的正在编辑中的表单，中断当前操作
			if (snow.left.find('form.editing').length > 0) {
				return;
			}

			var _doc = $(this).closest('div.doc').hide();
			// 赋值
			snow.editor.find('input[name="id"]').val(_doc.data('id'));

			_doc.after(snow.editor.click().slideDown(snow.speed, function() {
				snow.ue.setContent(_doc.find('.doc-content').html());
			}));

		}).on('click', '.frame .doc .doc-plus', function(e) {
			e.stopPropagation();
			// 如果有仍未提交的正在编辑中的表单，中断当前操作
			if (snow.left.find('form.editing').length) {
				return;
			}

			var _doc = $(this).closest('div.doc');
			if (!_doc.next().hasClass('clone')) {
				snow.editor.find('textarea').val('');
				_doc.after(snow.editor);
			}

			// 赋值
			snow.editor.find('input[name="id"]').val('');
			snow.ue.setContent('');

			snow.editor.click().slideDown(snow.speed);
		}).on('click', '.frame header .doc-plus', function(e) {
			e.stopPropagation();
			// 如果有仍未提交的正在编辑中的表单，中断当前操作
			if (snow.left.find('form.editing').length) {
				return;
			}

			var _doc = $(this).parent().hide().closest('header');

			// 赋值
			snow.editor.find('input[name="id"]').val('');
			snow.ue.setContent('');

			_doc.append(snow.editor.click().slideDown(snow.speed));
		});

		$("#qqLogin").click(function() {
			window.open('/connect/qq_login','sign_dialog','width=600,height=420,menubar=no,scrollbars=yes, resizable=yes,status=yes,titlebar=no,toolbar=no,location=yes');
		});

		function open_login(u){
			snow.account.nickName = u.NickName;
			snow.account.gender = u.Gender;
			snow.account.avatar = u.Avatar_1;
			snow.account.openFrom = u.From;
			snow.account.openId = u.OpenId;
			snow.account.accessToken = u.Token;

			checkin();
			$("#checkin-dialog").fadeOut(snow.speed);

			//记录登录状态
			$.post(snow.api.signTrace,{
				from:u.From,
				token:u.Token,
				openId:u.OpenId,
				nickName:u.NickName,
				gender:u.Gender,
				refresh:u.Refresh,
				avatar_1:u.Avatar_1,
				avatar_2:u.Avatar_2
			},function(d){
				log(d);
			});
		}
	});
	//

	//
	$(window).resize(function() {
		// 窗体宽度
		snow.width = $(this).width();
		// 书签
		$('div.bookmarks').css({
			top: (snow.nav.right.height() - 80) / 2
		});
		// 左侧工作区
		snow.left.css({
			right: snow.nav.right.width,
			left: snow.nav.left.width
		});
		//

	}).resize();
</script>